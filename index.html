<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>妙妙屋</title>
    <!-- 引入 animate.css 增加交互反馈 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@700&display=swap');
        
        body, html {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            background: #000;
            color: #fff;
            overflow: hidden;
            font-family: 'Noto Serif SC', serif;
            /* 禁止选中文字 */
            -webkit-user-select: none;
            user-select: none;
        }

        /* 1. 背景修复：直接使用 Base64 内嵌（虽然大，但绝对稳）或者 CDN */
        /* 由于图片 10MB 太大，内嵌会卡死。改为使用 GitHub Raw 强制 HTTPS */
        /* 增加多个备用源 */
        #bg-layer {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -100;
            /* 尝试使用 GitHub Pages 的绝对路径 */
            background-image: url('https://164474937-cmyk.github.io/divination-h5/bg.jpg?v=11.0');
            background-position: center center;
            background-repeat: no-repeat;
            background-size: cover;
            filter: brightness(0.6);
        }

        /* 2. 容器 */
        .app-wrapper {
            position: relative;
            z-index: 10;
            height: 100%;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding: 20px;
            padding-bottom: 80px;
        }

        .font-ancient { font-family: 'Ma Shan Zheng', cursive; }
        .text-neon-gold { color: #ffd700; text-shadow: 0 0 10px rgba(255, 215, 0, 0.8); }

        .cyber-panel {
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(0, 243, 255, 0.3);
            backdrop-filter: blur(5px);
            border-radius: 16px;
            margin-bottom: 24px;
        }

        select, input {
            display: block;
            width: 100%;
            height: 50px;
            font-size: 16px;
            background-color: rgba(255, 255, 255, 0.9) !important; /* 改回白色背景，确保可见 */
            color: #000 !important;
            border: 1px solid #00f3ff;
            border-radius: 8px;
            padding: 0 10px;
            margin-bottom: 0;
            -webkit-appearance: none;
            appearance: none;
        }

        /* 按钮点击态 */
        .btn-active:active { transform: scale(0.95); opacity: 0.8; }

        .fade-in-up { animation: fadeInUp 0.8s ease-out forwards; opacity: 0; transform: translateY(20px); }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }

        /* 错误提示 */
        #error-toast {
            position: fixed;
            top: 20%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 0, 0, 0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            z-index: 9999;
            display: none;
            font-size: 14px;
        }
    </style>
</head>
<body>

    <div id="bg-layer"></div>
    <div id="error-toast"></div>

    <div class="app-wrapper">
        
        <header class="text-center pt-10 pb-8 fade-in-up">
            <h1 class="text-6xl font-ancient text-neon-gold mb-2 tracking-widest">妙妙屋</h1>
            <p class="text-[10px] tracking-[0.3em] text-blue-300 font-mono uppercase">System 108.0 // v11.0</p>
        </header>

        <div id="input-section" class="cyber-panel p-6 fade-in-up" style="animation-delay: 0.1s;">
            <div class="text-center mb-6">
                <p class="font-ancient text-2xl text-white">录入时空坐标</p>
            </div>

            <div class="space-y-6">
                <div>
                    <label class="text-[10px] uppercase text-blue-400 tracking-widest mb-1 block">Name</label>
                    <input type="text" id="name" placeholder="输入您的姓名">
                </div>
                
                <div class="grid grid-cols-3 gap-3">
                    <div>
                        <label class="text-[10px] uppercase text-blue-400 tracking-widest mb-1 block">Year</label>
                        <select id="year">
                            <option value="" disabled selected>年</option>
                            <script>
                                for(let i=1950; i<=2030; i++) document.write(`<option value="${i}">${i}年</option>`);
                            </script>
                        </select>
                    </div>
                    <div>
                        <label class="text-[10px] uppercase text-blue-400 tracking-widest mb-1 block">Month</label>
                        <select id="month">
                            <option value="" disabled selected>月</option>
                            <script>
                                for(let i=1; i<=12; i++) document.write(`<option value="${i}">${i}月</option>`);
                            </script>
                        </select>
                    </div>
                    <div>
                        <label class="text-[10px] uppercase text-blue-400 tracking-widest mb-1 block">Day</label>
                        <select id="day">
                             <option value="" disabled selected>日</option>
                             <script>
                                for(let i=1; i<=31; i++) document.write(`<option value="${i}">${i}日</option>`);
                             </script>
                        </select>
                    </div>
                </div>

                <div>
                    <label class="text-[10px] uppercase text-blue-400 tracking-widest mb-1 block">Hour</label>
                    <select id="hour">
                        <option value="0">子时 (23:00-01:00)</option>
                        <option value="1">丑时 (01:00-03:00)</option>
                        <option value="2">寅时 (03:00-05:00)</option>
                        <option value="3">卯时 (05:00-07:00)</option>
                        <option value="4">辰时 (07:00-09:00)</option>
                        <option value="5">巳时 (09:00-11:00)</option>
                        <option value="6">午时 (11:00-13:00)</option>
                        <option value="7">未时 (13:00-15:00)</option>
                        <option value="8">申时 (15:00-17:00)</option>
                        <option value="9">酉时 (17:00-19:00)</option>
                        <option value="10">戌时 (19:00-21:00)</option>
                        <option value="11">亥时 (21:00-23:00)</option>
                    </select>
                </div>

                <!-- 修复：使用纯 CSS 类名控制的按钮，避免 JS 绑定失败 -->
                <!-- 并增加 data-action 属性，通过事件委托监听 -->
                <div id="start-btn" data-action="submit" class="w-full mt-6 bg-blue-600 text-white font-bold py-4 rounded-xl shadow-lg border border-blue-400 btn-active text-center cursor-pointer select-none">
                    <span class="font-ancient text-xl tracking-[0.5em] pointer-events-none">启动演算</span>
                </div>
                
                <!-- 隐藏的表单，用于辅助回车提交 -->
                <input type="submit" style="display:none">
            </div>
        </div>

        <div id="loading-section" class="hidden h-96 flex flex-col items-center justify-center">
            <div class="w-20 h-20 border-4 border-blue-500/30 border-t-blue-400 rounded-full animate-spin mb-6"></div>
            <p class="font-ancient text-2xl text-white">天机演算中...</p>
        </div>

        <div id="result-section" class="hidden space-y-6 pb-24"></div>

    </div>

    <script>
        // 全局错误提示
        function showToast(msg) {
            const t = document.getElementById('error-toast');
            t.innerText = msg;
            t.style.display = 'block';
            setTimeout(() => { t.style.display = 'none'; }, 2000);
        }

        // 命格数据库 (保持不变)
        const db = [
             { star: "紫微独坐 (帝王格)", slogan: "万王之王", desc: "紫微星单守命宫，犹如帝王临朝。", career: "适合决策层。", love: "眼光极高。", health: "注意脾胃。" },
             { star: "杀破狼 (变动格)", slogan: "动荡之源", desc: "命盘中最具爆发力的‘变动格’。", career: "适合创业。", love: "爱得轰轰烈烈。", health: "注意外伤。" },
             { star: "机月同梁 (吏人格)", slogan: "完美执行者", desc: "最稳健的执行者。", career: "适合公职。", love: "平淡是真。", health: "注意神经衰弱。" },
             { star: "府相朝垣 (富贵格)", slogan: "优雅贵族", desc: "天生的富贵格。", career: "适合金融。", love: "外貌协会。", health: "注意富贵病。" }
        ];

        // 核心逻辑函数
        window.runLogic = function() {
            try {
                const name = document.getElementById('name').value.trim();
                const y = document.getElementById('year').value;
                const m = document.getElementById('month').value;
                const d = document.getElementById('day').value;
                const h = document.getElementById('hour').value;

                if(!name) { showToast("请输入姓名"); return; }
                if(!y || !m || !d) { showToast("请选择完整日期"); return; }

                // 切换 UI
                document.getElementById('input-section').style.display = 'none';
                document.getElementById('loading-section').classList.remove('hidden');
                document.getElementById('loading-section').style.display = 'flex';

                // 异步模拟
                setTimeout(() => {
                    const seed = (parseInt(y)*1 + parseInt(m)*31 + parseInt(d)*100 + parseInt(h)*500);
                    const data = db[seed % db.length];

                    document.getElementById('loading-section').style.display = 'none';
                    const resDiv = document.getElementById('result-section');
                    resDiv.classList.remove('hidden');
                    resDiv.style.display = 'block';

                    resDiv.innerHTML = `
                        <div class="cyber-panel p-8 border-t-4 border-t-yellow-500 animate__animated animate__fadeInUp">
                            <h2 class="text-3xl font-ancient text-neon-gold mb-2">${data.star}</h2>
                            <p class="text-white text-lg">“${data.slogan}”</p>
                            <p class="text-gray-300 mt-4">${data.desc}</p>
                        </div>
                        <div class="cyber-panel p-6 border-l-4 border-l-blue-500 animate__animated animate__fadeInUp animate__delay-1s">
                            <h3 class="text-blue-400 font-bold">事业</h3><p class="text-gray-300">${data.career}</p>
                        </div>
                         <div class="text-center pt-8">
                            <div onclick="location.reload()" class="inline-block px-10 py-3 rounded-full border border-gray-600 text-gray-400 cursor-pointer">重测</div>
                        </div>
                    `;
                }, 1000);
            } catch(e) {
                alert("Runtime Error: " + e.message);
            }
        };

        // 强制绑定 (Event Delegation + Direct Binding)
        // 方案 A: 直接在 HTML 里写 onclick (已被证明部分环境失效)
        // 方案 B: 使用 addEventListener (推荐)
        // 方案 C: 暴力轮询绑定 (防止 DOM 未加载)
        
        let bindAttempt = 0;
        const binder = setInterval(() => {
            const btn = document.getElementById('start-btn');
            if(btn) {
                // 清除旧事件
                btn.onclick = null;
                // 绑定新事件 (同时支持 click 和 touch)
                btn.onclick = function(e) {
                    e.preventDefault();
                    window.runLogic();
                };
                btn.ontouchend = function(e) {
                    e.preventDefault();
                    window.runLogic();
                };
                console.log("Button bound successfully");
                clearInterval(binder);
            }
            bindAttempt++;
            if(bindAttempt > 50) clearInterval(binder); // 5秒后放弃
        }, 100);

    </script>
</body>
</html>
